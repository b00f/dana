branches:
  only:
    - master
    - devel

install:
  - set QTDIR=C:\Qt\5.9.2\mingw53_32
  - set MINGW=C:\Qt\Tools\mingw530_32
  - choco install -y InnoSetup
  - set PATH=%QTDIR%\bin;%MINGW%\bin;%PATH%;"C:\Program Files (x86)\Inno Setup 5"
  
build_script:
  - git submodule update --init --recursive
  - qmake source\dana.pro CONFIG+=release
  - mingw32-make
  
after_build:
  - windeployqt release/dana.exe
  - cmd: cp LICENSE release/LICENSE.txt
  - iscc ./installer/installer.iss
  - mv Output/dana-win32.exe dana-%APPVEYOR_REPO_TAG_NAME%-windows.exe 
  - rm release/*.o
  - rm release/*.cpp

artifacts:
  - path: dana-*.exe
    name: SetupExe
  
deploy:
  provider: GitHub
  on:
    appveyor_repo_tag: true
  auth_token:
     secure: DsQ/Nv6Df/ryOXUJhBBmDJFwZ6HHGaIauruGGnv4ouuhw9P6necvd8jjKohav/7Y
  artifact: SetupExe
  prerelease: true
  tag: $(APPVEYOR_REPO_TAG_NAME)
  release: $(APPVEYOR_REPO_TAG_NAME)
  description: $(APPVEYOR_REPO_COMMIT_MESSAGE)

